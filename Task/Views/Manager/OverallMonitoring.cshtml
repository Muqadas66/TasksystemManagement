@model Task.Models.TaskMonitoringViewModel
@{
    ViewBag.Title = "Overall Monitoring";
    Layout = "~/Views/Shared/_LayoutManager.cshtml";
}

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"> 

<div class="container mt-4">
    <h2 class="text-center text-primary mb-4">Overall Task Monitoring</h2>

    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th><i class="fas fa-tasks"></i> Task Title</th>
                        <th><i class="fas fa-check-circle"></i> Status</th>
                        <th><i class="fas fa-list-alt"></i> Number of Activities</th>
                        <th><i class="fas fa-chart-line"></i> Average Progress (%)</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var task in Model.Tasks)
                    {
                        var relatedActivities = Model.Activities
                            .Where(a => a.TaskId == task.AssignTaskID)
                            .ToList();
                        var averageProgress = relatedActivities.Any() ? relatedActivities.Average(a => a.ProgressPercentage ?? 0) : 0;

                        <tr>
                            <td>@task.Title</td>
                            <td>
                                <span class="badge badge-info">@task.Status</span>
                            </td>
                            <td>@relatedActivities.Count</td>
                            <td>@averageProgress</td>
                        </tr>
                    }
                    @if (!Model.Tasks.Any())
                    {
                        <tr>
                            <td colspan="4" class="text-center">No tasks found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 15px;
    }

    .table th, .table td {
        vertical-align: middle;
    }

    .badge {
        font-size: 0.9em;
    }
</style>
